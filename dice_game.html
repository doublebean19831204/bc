<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å¯Œç¿éª°å­é˜µ - åº„å®¶çš„æ•°å­¦é™·é˜±</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background: #121212;
            color: white;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #ffcc00;
            margin-bottom: 10px;
        }
        .board {
            background: #222;
            border-radius: 12px;
            padding: 20px;
            max-width: 920px;
            margin: 0 auto;
        }
        .board-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2em;
            color: #fff;
        }
        .grid {
            display: grid;
            --tile: 64px;
            grid-template-columns: repeat(9, var(--tile));
            grid-template-rows: repeat(6, var(--tile));
            gap: 6px;
            justify-content: center;
            align-content: center;
            margin: 0 auto 12px;
            padding: 12px;
            background: #111;
            border-radius: 14px;
            border: 1px solid #333;
            position: relative;
        }
        .cell {
            background: #f6f6f6;
            border: 2px solid #0e0e0e;
            border-radius: 10px;
            font-weight: 800;
            color: #0e0e0e;
            cursor: default;
            transition: transform 0.12s ease, filter 0.12s ease, background 0.12s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            user-select: none;
        }
        .cell .num {
            font-size: 18px;
            line-height: 1;
        }
        .cell .prize {
            margin-top: 4px;
            font-size: 12px;
            font-weight: 700;
            color: #ff4757;
            opacity: 0.95;
        }
        .cell.start {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
        }
        .cell.start .prize {
            color: #fff;
        }
        .cell.unreachable {
            background: #4b4b4b;
            color: #c7c7c7;
            border-color: #4b4b4b;
        }
        .cell.unreachable .prize {
            color: #d0d0d0;
            opacity: 0.8;
        }
        .cell.landed-trap {
            background: #6b6b6b;
            color: #f3f3f3;
            border-color: #6b6b6b;
            filter: saturate(0.9);
        }
        .cell.landed-trap .prize {
            color: #fff;
            opacity: 0.9;
        }
        .cell.win {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
            transform: translateY(-1px);
        }
        .cell.win .prize {
            color: #fff;
            opacity: 0.95;
        }

        .center-panel {
            grid-column: 2 / span 7;
            grid-row: 2 / span 4;
            background: #000;
            border-radius: 14px;
            border: 1px solid #222;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.55);
        }
        .dice-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .die {
            width: 60px;
            height: 60px;
            background: #ff4757;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
        }
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
        }
        button:hover {
            background: #ff4757;
        }
        .result {
            margin-top: 12px;
            padding: 15px;
            background: #333;
            border-radius: 8px;
            text-align: center;
            font-size: 1.1em;
            color: #ffcc00;
        }
        .info-panel {
            background: #222;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .info-panel h2 {
            color: #ffcc00;
            margin-top: 0;
        }
        .info-panel ul {
            padding-left: 20px;
        }
        .info-panel li {
            margin: 10px 0;
        }
        .highlight {
            color: #ffcc00;
            font-weight: bold;
        }
        .trap-info {
            color: #ff6b6b;
            font-style: italic;
        }
        .win-info {
            color: #4caf50;
        }
        .current-direction {
            font-size: 1.2em;
            text-align: center;
            margin: 0;
            color: #ffcc00;
        }
        .stats {
            margin-top: 15px;
            font-size: 0.9em;
            color: #aaa;
            text-align: center;
        }

        @media (max-width: 900px) {
            .grid { --tile: 52px; }
            .die { width: 52px; height: 52px; font-size: 22px; }
        }
        @media (max-width: 560px) {
            body { padding: 12px; }
            .grid { --tile: 44px; gap: 5px; padding: 10px; }
            .die { width: 46px; height: 46px; font-size: 20px; }
            button { padding: 9px 14px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ² å¤§å¯Œç¿éª°å­é˜µ â€”â€” åº„å®¶çš„æ•°å­¦é™·é˜±</h1>

        <div class="board">
            <div class="board-title">éª°å­é˜µï¼ˆæ–¹å—æ£‹ç›˜ï¼‰</div>
            <div id="grid" class="grid">
                <div class="center-panel" id="center-panel">
                    <div class="dice-container" id="dice-container">
                        <!-- éª°å­ä¼šåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="controls">
                        <button id="btn-clockwise">é¡ºæ—¶é’ˆ</button>
                        <button id="btn-counterclockwise">é€†æ—¶é’ˆ</button>
                        <button id="btn-roll">ğŸ² æ‘‡éª°å­</button>
                    </div>
                    <div class="current-direction" id="direction-display">è¯·é€‰æ‹©æ–¹å‘ â†’</div>
                </div>
            </div>
            <div class="result" id="result">ç‚¹å‡»â€œæ‘‡éª°å­â€å¼€å§‹æ¸¸æˆ</div>
            <div class="stats" id="stats">å·²ç©0æ¬¡ | æ€»äºæŸï¼šÂ¥0</div>
        </div>

        <div class="info-panel">
            <h2>ğŸ® æ¸¸æˆè¯´æ˜</h2>
            <p>è¿™æ˜¯ä¸€ä¸ªâ€œçœ‹ä¼¼èƒ½èµ¢ã€å®åˆ™å¿…è¾“â€çš„æ¦‚ç‡é™·é˜±æ¸¸æˆã€‚åº„å®¶æ—©å·²ç®—æ— é—ç­–ã€‚</p>
            
            <h3>ğŸ¯ æ¸¸æˆè§„åˆ™ï¼š</h3>
            <ol>
                <li>é€‰æ‹©â€œé¡ºæ—¶é’ˆâ€æˆ–â€œé€†æ—¶é’ˆâ€ä½œä¸ºä½ çš„ç§»åŠ¨æ–¹å‘</li>
                <li>ç‚¹å‡»â€œæ‘‡éª°å­â€ï¼Œç³»ç»Ÿéšæœºç”Ÿæˆ5ä¸ªéª°å­ç‚¹æ•°</li>
                <li>è®¡ç®—æ€»ç‚¹æ•°ï¼Œä»å¯¹åº”æ•°å­—æ ¼å­å‡ºå‘ï¼Œæ²¿ä½ é€‰çš„æ–¹å‘èµ°ç›¸åº”æ­¥æ•°</li>
                <li>æœ€ç»ˆåœåœ¨å“ªä¸€æ ¼ï¼Œä½ å°±è·å¾—è¯¥æ ¼å¥–é‡‘ï¼ˆæˆ–è½å…¥é™·é˜±ï¼‰</li>
            </ol>

            <h3>âš ï¸ ä¸‰å¤§é™·é˜±æ­ç§˜ï¼š</h3>
            <ul>
                <li><span class="trap-info">é™·é˜±â‘  å•åŒæ•°é™·é˜±</span>ï¼šæ— è®ºä½ é€‰å“ªä¸ªæ–¹å‘ï¼ŒæŸäº›æ ¼å­æ°¸è¿œæ— æ³•åˆ°è¾¾ï¼ˆå¦‚é¡ºæ—¶é’ˆé¿å¼€æ‰€æœ‰å¥‡æ•°æ ¼ï¼‰</li>
                <li><span class="trap-info">é™·é˜±â‘¡ ç»„åˆé™·é˜±</span>ï¼š5ä¸ªéª°å­æœ‰7776ç§ç»„åˆï¼Œå†ä¹˜ä»¥2ç§æ–¹å‘ = 15552ç§å¯èƒ½ï¼Œä¸­å¥–ç‡æä½</li>
                <li><span class="trap-info">é™·é˜±â‘¢ å¤§æ•°å®šå¾‹</span>ï¼šå•æ¬¡æœŸæœ›äºæŸ297å…ƒï¼Œç©10æ¬¡å¹³å‡äº2970å…ƒ â€”â€” ç©å¾—è¶Šå¤šï¼Œè¾“å¾—è¶Šç¨³ï¼</li>
            </ul>

            <h3>ğŸ’° å¥–é‡‘è®¾ç½®ï¼ˆç¤ºä¾‹ï¼‰ï¼š</h3>
            <p>å¤§éƒ¨åˆ†æ ¼å­å¥–é‡‘ä¸º Â¥100~Â¥500ï¼Œä½†æœ‰3ä¸ªâ€œå¤§å¥–æ ¼â€ï¼ˆå¦‚27å·ï¼‰å¯è¾¾ Â¥6000 â€”â€” ä½†ä½ å‡ ä¹ä¸å¯èƒ½èµ°åˆ°ï¼</p>

            <h3>ğŸ’¡ æ¸©é¦¨æç¤ºï¼š</h3>
            <p>ç”Ÿæ´»ä¸­å¾ˆå¤šâ€œæ¸¸æˆâ€ï¼ˆå½©ç¥¨ã€æŠ½å¥–ã€é‡‘èäº§å“ï¼‰éƒ½åƒè¿™ä¸ªæ¸¸æˆä¸€æ ·ï¼Œè¡¨é¢è¯±äººï¼Œå®åˆ™è®¾è®¡ç²¾å·§ã€‚è®°ä½ï¼š<span class="highlight">åªè¦å¯¹æ–¹æ•¢è®¾è§„åˆ™ï¼Œå°±ä¸€å®šç®—æ— é—ç­–</span>ã€‚</p>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        // å‚è€ƒæˆªå›¾ï¼šå¤–åœˆä¸ºæ•°å­—æ ¼ï¼Œä¸­é—´ç•™ç™½æ”¾éª°å­
        const boardLayout = [
            [10, 17, 12, 15, 14, 13, 16, 11, 18],
            [19, null, null, null, null, null, null, null, 9],
            [8,  null, null, null, null, null, null, null, 20],
            [21, null, null, null, null, null, null, null, 7],
            [6,  null, null, null, null, null, null, null, 22],
            [23, 30, 25, 28, 27, 26, 29, 24, 5]
        ];

        function buildRing(layout) {
            const rows = layout.length;
            const cols = layout[0].length;
            const ring = [];

            // top row
            for (let c = 0; c < cols; c++) {
                const v = layout[0][c];
                if (v != null) ring.push(v);
            }
            // right column (excluding corners)
            for (let r = 1; r < rows - 1; r++) {
                const v = layout[r][cols - 1];
                if (v != null) ring.push(v);
            }
            // bottom row (right to left)
            for (let c = cols - 1; c >= 0; c--) {
                const v = layout[rows - 1][c];
                if (v != null) ring.push(v);
            }
            // left column (excluding corners, bottom to top)
            for (let r = rows - 2; r >= 1; r--) {
                const v = layout[r][0];
                if (v != null) ring.push(v);
            }

            return ring;
        }

        const flatBoard = buildRing(boardLayout);

        const prizeMap = {
            1: 100, 2: 200, 3: 300, 4: 400, 5: 500,
            6: 100, 7: 200, 8: 300, 9: 400, 10: 500,
            11: 100, 12: 200, 13: 300, 14: 400, 15: 500,
            16: 100, 17: 200, 18: 300, 19: 400, 20: 500,
            21: 100, 22: 200, 23: 300, 24: 400, 25: 500,
            26: 100, 27: 6000, 28: 500, 29: 400, 30: 300
        };

        let currentDirection = null; // 'clockwise' or 'counterclockwise'
        let totalGames = 0;
        let totalLoss = 0;

        // åˆå§‹åŒ–æ£‹ç›˜
        function initBoard() {
            const grid = document.getElementById('grid');
            const centerPanel = document.getElementById('center-panel');
            grid.innerHTML = '';
            grid.appendChild(centerPanel);

            for (let r = 0; r < boardLayout.length; r++) {
                for (let c = 0; c < boardLayout[r].length; c++) {
                    const num = boardLayout[r][c];
                    if (num == null) continue;

                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.style.gridRow = String(r + 1);
                    cell.style.gridColumn = String(c + 1);
                    cell.dataset.num = String(num);

                    const numSpan = document.createElement('div');
                    numSpan.className = 'num';
                    numSpan.textContent = String(num);

                    const prize = prizeMap[num] || 0;
                    const prizeSpan = document.createElement('div');
                    prizeSpan.className = 'prize';
                    prizeSpan.textContent = prize ? `Â¥${prize}` : '';

                    cell.appendChild(numSpan);
                    cell.appendChild(prizeSpan);
                    grid.appendChild(cell);
                }
            }
        }

        // ç”Ÿæˆéª°å­
        function rollDice() {
            const diceContainer = document.getElementById('dice-container');
            diceContainer.innerHTML = '';
            const diceValues = [];
            for (let i = 0; i < 5; i++) {
                const value = Math.floor(Math.random() * 6) + 1;
                diceValues.push(value);
                const die = document.createElement('div');
                die.className = 'die';
                die.textContent = value;
                diceContainer.appendChild(die);
            }
            return diceValues;
        }

        // è®¡ç®—è·¯å¾„
        function calculatePath(startNum, steps, direction) {
            // æ‰¾åˆ°èµ·å§‹ä½ç½®ç´¢å¼•
            let startIndex = flatBoard.indexOf(startNum);
            if (startIndex === -1) {
                startIndex = 0; // fallback
            }

            const offset = direction === 'clockwise' ? steps : -steps;
            const len = flatBoard.length;
            const currentIndex = ((startIndex + (offset % len)) % len + len) % len;
            return flatBoard[currentIndex];
        }

        // æ ‡è®°é™·é˜±æ ¼å­
        function markTraps(direction) {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const num = parseInt(cell.dataset.num);
                if (direction === 'clockwise' && num % 2 === 1) {
                    cell.classList.add('unreachable');
                } else if (direction === 'counterclockwise' && num % 2 === 0) {
                    cell.classList.add('unreachable');
                } else {
                    cell.classList.remove('unreachable');
                }
            });
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(finalNum, prize, isTrap) {
            const resultDiv = document.getElementById('result');
            const statsDiv = document.getElementById('stats');
            
            if (isTrap) {
                resultDiv.innerHTML = `<span style="color:#ff6b6b">âŒ è½å…¥é™·é˜±ï¼ä½ ä»€ä¹ˆä¹Ÿæ²¡å¾—åˆ°ã€‚</span>`;
            } else {
                resultDiv.innerHTML = `<span style="color:#4caf50">ğŸ‰ æ­å–œï¼ä½ åœåœ¨ç¬¬${finalNum}æ ¼ï¼Œè·å¾— Â¥${prize}ï¼</span>`;
            }

            // æ›´æ–°ç»Ÿè®¡
            totalGames++;
            if (isTrap || prize < 297) {
                totalLoss += 297 - (prize || 0);
            }
            statsDiv.textContent = `å·²ç©${totalGames}æ¬¡ | æ€»äºæŸï¼šÂ¥${totalLoss}`;
        }

        // ä¸»æ¸¸æˆé€»è¾‘
        document.getElementById('btn-clockwise').addEventListener('click', () => {
            currentDirection = 'clockwise';
            document.getElementById('direction-display').textContent = 'å½“å‰æ–¹å‘ï¼šé¡ºæ—¶é’ˆ';
            markTraps(currentDirection);
        });

        document.getElementById('btn-counterclockwise').addEventListener('click', () => {
            currentDirection = 'counterclockwise';
            document.getElementById('direction-display').textContent = 'å½“å‰æ–¹å‘ï¼šé€†æ—¶é’ˆ';
            markTraps(currentDirection);
        });

        document.getElementById('btn-roll').addEventListener('click', () => {
            if (!currentDirection) {
                alert('è¯·å…ˆé€‰æ‹©æ–¹å‘ï¼');
                return;
            }

            const diceValues = rollDice();
            const totalSteps = diceValues.reduce((a, b) => a + b, 0);
            const startNum = totalSteps; // ä»æ€»ç‚¹æ•°å¯¹åº”çš„æ ¼å­å¼€å§‹

            // å¦‚æœèµ·å§‹æ ¼ä¸å­˜åœ¨ï¼Œå–æœ€è¿‘çš„
            const validStart = flatBoard.includes(startNum) ? startNum : flatBoard[0];
            
            const finalNum = calculatePath(validStart, totalSteps, currentDirection);

            // åˆ¤æ–­æ˜¯å¦æ˜¯é™·é˜±æ ¼ï¼ˆæ ¹æ®æ–¹å‘ï¼‰
            let isTrap = false;
            if (currentDirection === 'clockwise' && finalNum % 2 === 1) {
                isTrap = true;
            } else if (currentDirection === 'counterclockwise' && finalNum % 2 === 0) {
                isTrap = true;
            }

            const prize = prizeMap[finalNum] || 0;

            // é«˜äº®èµ·å§‹æ ¼å’Œç»ˆç‚¹æ ¼
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.classList.remove('start', 'win', 'landed-trap');
                if (parseInt(cell.dataset.num) === validStart) {
                    cell.classList.add('start');
                }
                if (parseInt(cell.dataset.num) === finalNum) {
                    cell.classList.add(isTrap ? 'landed-trap' : 'win');
                }
            });

            showResult(finalNum, prize, isTrap);
        });

        // åˆå§‹åŒ–
        window.onload = () => {
            initBoard();
        };
    </script>
</body>
</html>
